# 代码生成规则

## 角色定位
作为代码生成器，负责根据需求生成高质量的Go代码，实现功能特性，并进行bug测试和修复。

## 开发规范

### 1. 技术栈要求
- 后端语言：Go
- 数据库：SQLite（推荐）
- 前端模板：HTML + Go Template
- 构建工具：Makefile + Go Modules

### 2. 项目结构要求
必须遵循现有项目结构：
```
speed-check/
├── app/           # Web应用主逻辑
├── check/         # 节点检测相关
├── config/        # 配置管理
├── storage/       # 数据库存储
├── proxy/         # 代理相关功能
├── utils/         # 工具函数
├── assets/        # 静态资源
└── doc/           # 文档
```

### 3. 核心功能实现要求

#### 3.1 Web服务
- 实现基于HTTP的Web服务
- 提供节点管理界面
- 提供结果展示界面
- 提供配置管理界面

#### 3.2 定时任务系统
- 实现每日速度测试调度
- 实现每月IP纯净度测试调度
- 支持自定义调度周期配置

#### 3.3 数据库设计
表结构应包括：
- 订阅信息表
- 节点速度测试结果表
- 节点纯净度测试结果表
- 系统配置表

#### 3.4 检测功能
- 速度检测：实现网络速度测试
- 纯净度检测：实现IP质量检测
- 优化策略：只对Top-N节点进行纯净度检测

### 4. 代码质量要求

#### 4.1 编码规范
- 遵循Go语言编码规范
- 函数和变量命名具有描述性
- 适当添加注释说明复杂逻辑

#### 4.2 错误处理
- 所有错误都需要处理
- 提供友好的错误信息
- 实现重试机制处理网络异常

#### 4.3 并发安全
- 多goroutine访问共享资源时需要加锁
- 合理控制并发数量
- 避免死锁和资源竞争

### 5. 测试要求

#### 5.1 单元测试
- 关键函数需要提供单元测试
- 数据库操作需要测试
- API接口需要测试

#### 5.2 集成测试
- 定时任务功能测试
- 数据库读写测试
- Web服务接口测试

### 6. 部署要求
- 提供systemd服务配置文件
- 提供Dockerfile（如果需要）
- 提供详细的部署文档
- 支持Ubuntu 24.04 LTS (arm64/amd64)

## Bug修复流程
1. 重现问题
2. 定位根本原因
3. 设计修复方案
4. 实现修复代码
5. 验证修复效果
6. 添加回归测试

## 输出要求
生成代码时需要：
1. 提供完整的可运行代码
2. 包含必要的注释说明
3. 确保没有语法错误
4. 遵循项目现有的代码风格
5. 提供必要的使用说明